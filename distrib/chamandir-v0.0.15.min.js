function Cha(a){this._constructor=ChaManDir.evolve(Base,a)}function Base(){this.initialize&&this.initialize.apply(this,arguments)}function Events(){}var chamandir=function(){};chamandir.prototype={settings:{},clone:function(a){function b(){Cha.apply(this,arguments)}return b.prototype=new a,b},evolve:function(a,b){var c=this.clone(a),d=c.prototype._super_?{_super_:c.prototype._super_}:{};for(var e in b)"function"==typeof b[e]&&this.possess(c,e)&&"_super"!==e?(d[e]=c.prototype[e],c.prototype[e]=this._super(e,b[e])):c.prototype[e]=b[e];return c.prototype._super_=d,c},_super:function(a,b){return function(){this._method=a,this._arguments=arguments;var c=b.apply(this,arguments);return delete this._method,delete this._arguments,delete this.__supper__,c}},possess:function(a,b){for(var c=a.prototype;c;){if(c[b])return!0;c=c._super}return!1},define:function(a){return new ChaManDir.Cha(a)},log:function(a,b){console.log(a),b&&console.log(b),console.log("######################")}},ChaManDir=new chamandir,Cha.prototype={create:function(){var a=new this._constructor;return a.initialize&&a.initialize.apply(a,arguments),a},evolve:function(a){var b=new ChaManDir.Cha;return b._constructor=ChaManDir.evolve(this._constructor,a),b},adopt:function(a){var b=new ChaManDir.Cha;return b._constructor=this._adopt(a),b},_adopt:function(a){var b="function"==typeof a?a.prototype:a._constructor.prototype;return ChaManDir.evolve(this._constructor,b)},adapt:function(a){var b=this._adopt(a);return this._constructor=b,this}},ChaManDir.Cha=Cha,Base.prototype={_super:function(){for(var a,b=this.__supper__||this._super_;!a&&b;)a=b[this._method],b=b._super_,this.__supper__=b;return a?a.apply(this,this._arguments):void 0}},ChaManDir.Cha.Base=Base,ChaManDir.Cha.Gatherer=ChaManDir.define({initialize:function(){this._super(),this.stash=ChaManDir.Cha.Gatherer.Stash.create()},gather:function(a,b){if(this.stash.have(a))return this.stash[a];if(this[a]&&"function"==typeof this[a])return this.stash.store(a,this[a].apply(this,b));if(b&&!this[a])return console.log("test"),this.stash.store(a,b);throw new Error(a+" method is missing!!!")},ditch:function(a){return this.stash.release(a),this},empty:function(){return this.stash=ChaManDir.Cha.Gatherer.Stash.create(),this},reset:function(a,b){return this.ditch(a).gather(a,b)}}),ChaManDir.Cha.Gatherer.Stash=ChaManDir.define({initialize:function(){this.exists={}},have:function(a){return this.exists[a]?!0:!1},store:function(a,b){return this[a]=b,this.exists[a]=!0,b},release:function(a){return delete this[a],this.exists[a]=!1,this}}),Events.prototype={},ChaManDir.Events=new Events,ChaManDir.Events.Delegator=ChaManDir.define({initialize:function(){this._super(),this.handler=ChaManDir.Events.Handler.create(),this.hooks()},hooks:function(){},bind:function(a,b,c){var c=c||this;this.handler.bind(a,b,c)},unbind:function(a){this.handler.unbind(a)},trigger:function(a,b){this.handler.trigger(a,b)}}),ChaManDir.Events.Handler=ChaManDir.define({initialize:function(){this._super(),this.handlers={},this.events=[]},sub_events:function(a){return a?a instanceof Array?a:a.split("."):[]},bind:function(a,b,c){var d=this.sub_events(a),e=d.shift();e?(this.handlers[e]||(this.handlers[e]=ChaManDir.Events.Handler.create()),this.handlers[e].bind(d,b,c)):this._bind(b,c)},_bind:function(a,b){this.events.push(ChaManDir.Events.Event.create(a,b))},unbind:function(a){var b=this.sub_events(a),c=b.shift();b.length?this.handlers[c]&&this.handlers[c].unbind(b):delete this.handlers[c]},trigger:function(a,b){var c=this.sub_events(a),d=c.shift();d?this.handlers[d]&&this.handlers[d].trigger(c,b):this._trigger(b)},_trigger:function(a){for(var b in this.handlers)this.handlers[b].trigger([],a);for(var b=0;b<this.events.length;b++)this.events[b].trigger(a)}}),ChaManDir.Events.Event=ChaManDir.define({initialize:function(a,b){this.callback=a,this.requestor=b},trigger:function(a){this.context=a,this.callback.call(this.requestor,this),delete this.context}}),ChaManDir.Events.Quest=ChaManDir.Events.Delegator.evolve({initialize:function(a,b){this._super(),this.tasks=[],this.progress=0,this.reward=a,this.punishment=b},task:function(a){return this.tasks.push(a),this},start:function(){var a=this;if(this.tasks.length>0)for(var b=0;b<this.tasks.length;b++)this.tasks[b](function(b){a.complete(b)},function(b){a.failure(b)});else this.complete()},complete:function(){this.progress++,this.progress>=this.tasks.length&&this.done()},failure:function(a){this.punishment(a)},done:function(){this.reward()}}),"object"==typeof exports?module.exports=ChaManDir:"function"==typeof define&&define.amd?define(ChaManDir):Âµ=ChaManDir;